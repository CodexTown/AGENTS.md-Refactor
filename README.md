# Автоматизированный рефакторинг

Этот проект следит за двумя зонами: исходный код (`./_in`) остается неизменным, а все переработанные модули и тесты записываются только в `./_out`. Процесс базируется на `STYLEGUIDE.md` и состоит из трёх агентов, каждый с чёткой зоной ответственности.

## Инварианты
- `STYLEGUIDE.md` всегда в корне и только читается.
- Исходники `./_in/**/*.py` — read-only.
- Результаты `./_out/**/*.py` — единственные файлы, которые можно изменять или создавать.
- Поведение кода нельзя менять: сигнатуры, побочные эффекты и контракты остаются прежними.
- Изменения минимальны: фокус на структуре, типах и docstring.

## Как работает агент
1. **orchestrator.legacy_refactor** принимает от пользователя файл из `_in`, читает `STYLEGUIDE.md` и передаёт задачу профильным агентам. Он получает от `dev.legacy_refactorer` обновлённый модуль, пишет его в `_out`, показывает diff с оригиналом и, при необходимости, запускает `pytest`, чтобы убедиться, что тесты из `_out` проходят.
2. **dev.legacy_refactorer** берёт конкретный модуль из `_in`, анализирует функции, выделяет логические блоки, добавляет типы и docstring в соответствии со стилгайдом, но не меняет саму логику. Итог записывается исключительно в `_out`.
3. **qa.test_writer** строит или дополняет тесты для отрефакторенного модуля, ориентируясь на публичные функции и важные ветви. Тесты пишутся в `_out` и запускаются через `pytest`, а внешние зависимости сводятся к минимуму.

## Рекомендации
- Перед рефакторингом всегда перечитывайте `STYLEGUIDE.md`.
- Фиксируйте все изменения в `_out`, не трогая `_in`.
- После генерации тестов прогоняйте `pytest`, чтобы убедиться в стабильности.
